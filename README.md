# xlf-sync

> **The definitive CLI tool for synchronizing Angular XLIFF (1.2 & 2.0) locale files.**

**`xlf-sync`** is a robust, production-ready utility designed to solve the persistent challenge of Angular i18n management: keeping your locale files (`messages.<locale>.xlf`) in perfect sync with your source file (`messages.xlf`), without data loss or corruption.

It is built to integrate seamlessly into professional workflows, supporting both local development and strict CI/CD pipelines.

---

## âœ¨ Key Features

- **ğŸ”„ Full Synchronization**: Automatically adds missing keys from `messages.xlf` to all your locale files.
- **ğŸ›¡ï¸ Data Safety**: Never overwrites existing translations. Your work is safe.
- **ğŸ§¬ Multi-Version Support**: Seamlessly handles **XLIFF 1.2** and **2.0** in the same project. It auto-detects the version per file.
- **ğŸ§¹ Auto-Sorting**: Reorders translations in locale files to match the source file's order, ensuring clean and readable diffs.
- **ğŸ’€ Graveyard Mode**: Optionally moves obsolete keys to a separate "graveyard" file instead of deleting them, preserving historical work.
- **ğŸ¤– CI/CD Ready**: Dedicated `check` command with strict exit codes for your build pipelines.
- **âœ¨ Pretty Printing**: Normalizes XML formatting across all files, eliminating "dirty" diffs from other tools.

---

## ğŸ“¦ Installation

Install globally or as a dev dependency in your project:

```bash
npm install -D xlf-sync
```

Run via `npx` or add a script to your `package.json`:

```bash
npx xlf-sync --help
```

---

## ğŸš€ Usage

### 1. The `sync` Command

The core command to update your locale files. It reads the source file and updates all target locale files found by the glob pattern.

```bash
# Basic usage
npx xlf-sync sync \
  --source src/locale/messages.xlf \
  --locales "src/locale/messages.*.xlf"
```

#### Sync Options

| Option | Default | Description |
| :--- | :--- | :--- |
| `--source <path>` | `src/locale/messages.xlf` | Path to the source XLIFF file generated by `ng extract-i18n`. |
| `--locales <glob>` | `src/locale/messages.*.xlf` | Glob pattern to find your target locale files (e.g., `src/locale/*.xlf`). |
| `--new-target <mode>` | `todo` | **Strategy for new keys:**<br>â€¢ `todo`: Fills target with `TODO`.<br>â€¢ `empty`: Leaves target empty.<br>â€¢ `source`: Copies source text to target. |
| `--obsolete <mode>` | `mark` | **Strategy for removed source keys:**<br>â€¢ `mark`: Keeps key with `state="obsolete"` (or prefix).<br>â€¢ `delete`: Permanently removes the key.<br>â€¢ `graveyard`: Moves key to a separate file (see below). |
| `--graveyard-file <pattern>` | `src/locale/_obsolete.{locale}.xlf` | Pattern for the output "graveyard" file. Used only if `--obsolete graveyard`. `{locale}` is replaced dynamically. |
| `--fail-on-missing` | `false` | Exits with error (code 1) if any keys are missing translations. Useful if you want to enforce 100% translation coverage during sync. |
| `--dry-run` | `false` | Simulates the operation without writing changes to disk. |

---


---

### 2. The `report` Command

Generates a detailed console report about the translation coverage for each locale file. Useful for getting a quick overview of work remaining.

```bash
npx xlf-sync report --source src/locale/messages.xlf --locales "src/locale/messages.*.xlf"
```

**Output Example:**
```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Locale â”‚ XLF â”‚ Keys â”‚ Translated â”‚ Pending â”‚ % Cov  â”‚ Words â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ de     â”‚ 2.0 â”‚ 120  â”‚ 115        â”‚ 5       â”‚ 95.8%  â”‚ 432   â”‚
â”‚ fr     â”‚ 2.0 â”‚ 120  â”‚ 40         â”‚ 80      â”‚ 33.3%  â”‚ 150   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Report Options

| Option | Default | Description |
| :--- | :--- | :--- |
| `--source <path>` | `src/locale/messages.xlf` | Path to the source XLIFF file. |
| `--locales <glob>` | `src/locale/messages.*.xlf` | Glob pattern for target locale files. |

---

### 3. The `check` Command

A read-only command designed for **Continuous Integration (CI)** pipelines. It verifies the state of your translations without modifying any files.

```bash
# Check if files are in sync
npx xlf-sync check --fail-on-missing
```

#### Check Options

| Option | Default | Description |
| :--- | :--- | :--- |
| `--source <path>` | `src/locale/messages.xlf` | Path to the source XLIFF file. |
| `--locales <glob>` | `src/locale/messages.*.xlf` | Glob pattern for target locale files. |
| `--verbose` | `false` | Lists exactly which keys are missing or obsolete for each locale. |
| `--fail-on-missing` | `false` | **CI Failure Condition**: Fail if any translation targets are missing or empty. |
| `--fail-on-obsolete` | `false` | **CI Failure Condition**: Fail if obsolete keys exist in locale files. |
| `--fail-on-added` | `false` | **CI Failure Condition**: Fail if new keys exist in source that haven't been synced to locales yet. |

---

## ğŸ“š Advanced Workflows

### Keeping Files Clean (Graveyard Mode)

For large, long-lived projects, we recommend the **Graveyard Strategy**. Instead of cluttering your main files with obsolete keys or deleting them immediately (and losing work), this mode moves them to a separate file.

```bash
npx xlf-sync sync --obsolete graveyard
```

**Result:**
- `messages.fr.xlf`: Contains **only** active, valid translations.
- `_obsolete.fr.xlf`: Contains all retired keys. You can restore them later if needed.

### Standard CI/CD Pipeline

Add this step to your Pull Request validation workflow to ensure no developer merges broken translations:

```yaml
- name: Verify i18n Sync
  run: npx xlf-sync check --fail-on-missing --fail-on-added --verbose
```

---

## ğŸ› ï¸ Supported Formats

| Format | Support Level |
| :--- | :--- |
| **XLIFF 1.2** | Legacy Angular projects. Supported fully. |
| **XLIFF 2.0** | Modern Angular default. Supported fully. |
| **Hybrid** | Mixed version projects are detecting and handled automatically per file. |

---


---

## ğŸ¤ Contributing

We welcome contributions! Whether it's bug reports, feature requests, or code contributions, your help is appreciated.

Please read our [Contributing Guidelines](CONTRIBUTING.md) to get started.

**Quick ways to contribute:**
- â­ [Star the project](https://github.com/atheodosiou/xlf-sync) on GitHub
- ğŸ› [Report bugs](https://github.com/atheodosiou/xlf-sync/issues/new)
- ğŸ’¡ [Suggest features](https://github.com/atheodosiou/xlf-sync/issues/new)
- ğŸ”§ [Submit pull requests](https://github.com/atheodosiou/xlf-sync/pulls)

---

## ğŸ“„ License

MIT Â© Anastasios Theodosiou